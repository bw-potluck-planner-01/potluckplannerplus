exports.up = async (knex) => {
  await knex.schema
    .createTable('organizers', (users) => {
      users.increments('organizer_id')
      users.string('username', 128).unique().notNullable()
      users.string('password', 128).notNullable()
    })
    .createTable('potlucks', (potlucks) => {
      potlucks.increments('potluck_id')
      potlucks.string('potluck_name', 128).unique().notNullable()
      potlucks.date('date', 128).notNullable()
      potlucks.time('time', 128).notNullable()
      potlucks.string('location', 256).notNullable()
      potlucks.integer("organizer_id")
              .unsigned()
              .notNullable()
              .references('organizer_id')
              .inTable('organizers')
              .onUpdate('CASCADE')
              .onDelete('RESTRICT')
    })
    .createTable('guests', (guests) => {
      guests.increments('guest_id')
      guests.string('username', 128).notNullable()
      guests.boolean('attending').defaultTo(false)
      guests.integer('potluck_id')
            .unsigned()
            .notNullable()
            .references('potluck_id')
            .inTable('potlucks')
            .onUpdate('CASCADE')
            .onDelete('RESTRICT')
    })
    .createTable('food_items', (food_items) => {
      food_items.increments('food_item_id')
      food_items.string('food_item', 128).notNullable()
      food_items.integer('potluck_id')
                .unsigned()
                .notNullable()
                .references('potluck_id')
                .inTable('potlucks')
                .onUpdate('CASCADE')
                .onDelete('RESTRICT')
    })
    .createTable('guest_food_items', (food_items) => {
      food_items.increments('guest_food_item_id')
      food_items.integer('food_item_id')
                .unsigned()
                .notNullable()
                .references('food_item_id')
                .inTable('food_items')
                .onUpdate('CASCADE')
                .onDelete('RESTRICT')
      food_items.integer('guest_id')
                .unsigned()
                .notNullable()
                .references('organizer_id')
                .inTable('organizers')
                .onUpdate('CASCADE')
                .onDelete('RESTRICT')
    })
}

exports.down = async (knex) => {
  await knex.schema
            .dropTableIfExists('guest_food_items')
            .dropTableIfExists('food_items')
            .dropTableIfExists('guests')
            .dropTableIfExists('potlucks')
            .dropTableIfExists('organizers')
}
